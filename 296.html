<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #296 (Stitching multiple series needs improvement)
     â€“ LOCI Software
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/trac/software/search" />
        <link rel="prev" href="/trac/software/ticket/295" title="Ticket #295" />
        <link rel="last" href="/trac/software/ticket/822" title="Ticket #822" />
        <link rel="help" href="/trac/software/wiki/TracGuide" />
        <link rel="alternate" href="/trac/software/ticket/296?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/trac/software/ticket/296?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/trac/software/ticket/296?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/trac/software/ticket/297" title="Ticket #297" />
        <link rel="start" href="/trac/software/wiki" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" />
        <link rel="first" href="/trac/software/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/trac/software/chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="/trac/software/chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/trac/software/search/opensearch" title="Search LOCI Software" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="5d65bc08bc7cc61f5f9070f5";
    </script>
    <script type="text/javascript" src="/trac/software/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/babel.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/trac.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/search.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/folding.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/software/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 296, escape_newlines: 0}
        $("#comment").autoPreview("/trac/software/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/trac/software/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://loci.wisc.edu/"><img src="http://loci.wisc.edu/loci-logo.png" alt="LOCI" height="98" width="300" /></a>
      </div>
      <form id="search" action="/trac/software/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/trac/software/login">Login</a></li><li><a href="/trac/software/wiki/TracGuide">Help/Guide</a></li><li><a href="/trac/software/about">About Trac</a></li><li><a href="/trac/software/prefs">Preferences</a></li><li class="last"><a href="/trac/software/reset_password">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/trac/software/wiki">Wiki</a></li><li><a href="/trac/software/timeline">Timeline</a></li><li><a href="/trac/software/roadmap">Roadmap</a></li><li><a href="/trac/software/browser">Browse Source</a></li><li class="active"><a href="/trac/software/report">View Tickets</a></li><li class="last"><a href="/trac/software/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="/trac/software/ticket/295" title="Ticket #295">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="/trac/software/ticket/297" title="Ticket #297">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/trac/software/ticket/296">Ticket #296</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/trac/software/timeline?from=2008-05-07T17%3A38%3A23-05%3A00&amp;precision=second" title="2008-05-07T17:38:23-05:00 in Timeline">11 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/trac/software/timeline?from=2010-10-04T13%3A55%3A28-05%3A00&amp;precision=second" title="2010-10-04T13:55:28-05:00 in Timeline">9 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Stitching multiple series needs improvement</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/trac/software/query?status=!closed&amp;reporter=curtis">curtis</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/trac/software/query?status=!closed&amp;owner=melissa">melissa</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/trac/software/query?status=!closed&amp;priority=minor">minor</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/trac/software/milestone/bio-formats-4.2.1">bio-formats-4.2.1</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/trac/software/query?status=!closed&amp;component=bio-formats">bio-formats</a>
        </td>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/trac/software/query?status=!closed&amp;severity=serious">serious</a>
        </td>
    </tr><tr>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
    </tr><tr>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
The <tt>FileStitcher</tt> and <tt>AxisGuesser</tt> classes currently have logic for stitching together multi-series datasets distributed across multiple files. The organization of such datasets could vary greatly, but see <tt>dicom/john/Fake Set</tt> for one example.
</p>
<p>
There are two possible situations:
</p>
<ol><li>Each file contains multiple image series (presumably the same number of series per file).
</li><li>Image series are distributed using file numbering.
</li></ol><p>
In addition, a dataset could conceivably fall into both categories. The problem in either case is that each series can have its own image count with differing sizeZ, sizeC and sizeT values. The current code does not handle such differences elegantly.
</p>
<p>
As a first step, I would like to remove the multi-series logic from <tt>FileStitcher</tt> altogether. The resulting code should be significantly shorter and easier to understand.
</p>
<p>
Once the multi-series code has been removed, we should reexamine how to best handle multi-series stitched datasets. Some considerations:
</p>
<ol><li>A single file pattern fundamentally cannot represent multiple series distributed across files using one or more "series" axis types, since the resultant pattern may not be rectangular. Rather, each series should have its own pattern.
</li><li>We can detect when the files in a folder are conceivably problematic by checking whether the "pattern reduction" logic gets invoked (see <a class="source" href="/trac/software/browser/trunk/loci/formats/FilePattern.java">source:trunk/loci/formats/FilePattern.java</a>, at the bottom of the <tt>findPattern</tt> method around line 459). When we detect this situation happening, we could invoke more thorough filename analysis logic to puzzle out which numerical axes represent series variability, ultimately producing one file pattern per series.
</li><li>We could check upfront whether all files in the pattern "exist" (are on the list), and if not, make inferences from which ones are missing.
</li></ol><p>
Regardless, there will be pathological situations where we cannot know which axes represent multiple series, just as we cannot always tell which are Z, T or C axes.
</p>
<p>
We should consider encapsulating series-specific logic into a new class if possible, to avoid complicating the <tt>FileStitcher</tt> class any more than necessary.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/trac/software/timeline?from=2010-08-27T17%3A31%3A15-05%3A00&amp;precision=second" title="2010-08-27T17:31:15-05:00 in Timeline">9 years</a> ago by melissa
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>curtis</em> to <em>melissa</em>
    </li><li>
      <strong>Milestone</strong>
        set to <em>bio-formats-4.2.1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
This is related to <a class="closed ticket" href="/trac/software/ticket/542" title="defect: Multi-series stitching is incorrect (closed: fixed)">#542</a>.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/trac/software/timeline?from=2010-10-04T13%3A55%3A28-05%3A00&amp;precision=second" title="2010-10-04T13:55:28-05:00 in Timeline">9 years</a> ago by melissa
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
(In <a class="changeset" href="/trac/software/changeset/7021" title="Updated FileStitcher and FilePattern to better handle multi-series ...">[7021]</a>) Updated FileStitcher and FilePattern to better handle multi-series datasets in which the series axis is spread across multiple files.  Closes <a class="closed ticket" href="/trac/software/ticket/296" title="defect: Stitching multiple series needs improvement (closed: fixed)">#296</a>, closes <a class="closed ticket" href="/trac/software/ticket/542" title="defect: Multi-series stitching is incorrect (closed: fixed)">#542</a>.
</p>
<p>
Note that datasets such as S&lt;0-2&gt;_T&lt;0-10&gt;.lif with each file containing multiple series are still unsupported.  However, attempting to stitch datasets of this type will result in an informative exception.
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/trac/software/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/trac/software/ticket/296?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/trac/software/ticket/296?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/trac/software/ticket/296?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/trac/software/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/trac/software/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the LOCI software web site at<br /><a href="http://loci.wisc.edu/software/">http://loci.wisc.edu/software/</a></p>
    </div>
  </body>
</html>
