<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #405 (OME-TIFF export erroneously reuses OME metadata from input dataset)
     â€“ LOCI Software
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="239a3e38062fabfae1da3669";
    </script>
    <script type="text/javascript" src="/trac/software/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/babel.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/trac.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/search.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/folding.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/trac/software/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/trac/software/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 405, escape_newlines: 0}
        $("#comment").autoPreview("/trac/software/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/trac/software/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/trac/software/ticket/405">Ticket #405</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2009-07-03T13:43:14-05:00</p>
    <p>Last modified 2009-10-12T10:15:31-05:00</p>
  </div>
  <h2 class="summary searchable">OME-TIFF export erroneously reuses OME metadata from input dataset</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/trac/software/query?status=!closed&amp;reporter=curtis">curtis</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/trac/software/query?status=!closed&amp;owner=melissa">melissa</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/trac/software/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/trac/software/milestone/bio-formats-4.1">bio-formats-4.1</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/trac/software/query?status=!closed&amp;component=plugins">plugins</a>
        </td>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/trac/software/query?status=!closed&amp;severity=critical">critical</a>
        </td>
    </tr><tr>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
    </tr><tr>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2009-07-03 19:05:56+00:00">
        (last modified by curtis)
        (<a href="/trac/software/ticket/405?action=diff&amp;version=1">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <p>
The Bio-Formats Exporter plugin feeds the input dataset's OME-XML directly to the output writer, which is fine in the simple case but can often cause problems. (Upon initial inspection, the bfconvert command line utility does not appear to have these problems, though it would be good to check the code to verify.)
</p>
<p>
For example, the Exporter is unable to export datasets opened from series beyond the first when the dimensions differ:
</p>
<pre class="wiki">run("Bio-Formats Importer", "open=[/Volumes/DATA/leica-lif/andrew/Par6 GFP delaminating cells.lif] view=Hyperstack stack_order=XYCZT series022");
run("Bio-Formats Exporter", "compression=Uncompressed save=/Users/curtis/Desktop/out.ome.tif");
</pre><p>
Results in an exception:
</p>
<pre class="wiki">java.lang.IllegalArgumentException: ZCT size vs image count mismatch (sizeZ=5, sizeC=1, sizeT=2, total=51)
	at loci.formats.FormatTools.getZCTCoords(FormatTools.java:293)
	at loci.formats.out.OMETiffWriter.close(OMETiffWriter.java:125)
	at loci.formats.out.TiffWriter.saveBytes(TiffWriter.java:170)
	at loci.formats.out.TiffWriter.saveBytes(TiffWriter.java:191)
	at loci.formats.out.OMETiffWriter.saveBytes(OMETiffWriter.java:171)
	at loci.formats.FormatWriter.saveBytes(FormatWriter.java:89)
	at loci.plugins.exporter.Exporter.run(Exporter.java:367)
	at loci.plugins.LociExporter.run(LociExporter.java:73)
</pre><p>
Another example is if you have imported only a subset of the data, using split channels, or specify ranges:
</p>
<pre class="wiki">run("Bio-Formats Importer", "open=/Volumes/DATA/deltavision/brian/lung-lentiCMtriple-1_R3D.dv autoscale split_channels view=Hyperstack stack_order=XYCZT");
close();
run("Bio-Formats Exporter", "save=/Users/curtis/Desktop/lung_c2.ome.tif compression=Uncompressed");
</pre><p>
Here the OME-TIFF file successfully exports, but SizeC is still 2 instead of 1, resulting in missing planes, and a fallback behavior to the vanilla TIFF reader on subsequent import.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2009-07-03T14:05:56-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="/trac/software/ticket/405?action=diff&amp;version=1">diff</a>)
    </li><li>
      <strong>Summary</strong>
        changed from <em>OME-TIFF export ZCT/image count mismatch for series beyond the first</em> to <em>OME-TIFF export erroneously reuses OME metadata from input dataset</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2009-07-03T14:19:54-05:00 by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
Another likely example:
</p>
<pre class="wiki">run("Bio-Formats Importer", "open=/Volumes/DATA/zeiss-zvi/nicolas/image.zvi crop view=Hyperstack stack_order=XYCZT x_coordinate_1=0 y_coordinate_1=0 width_1=1023 height_1=1022");
run("Bio-Formats Exporter", "compression=Uncompressed save=/Users/curtis/Desktop/image.ome.tif");
</pre><p>
Results in:
</p>
<pre class="wiki">java.lang.ArithmeticException: / by zero
	at loci.formats.gui.AWTTiffTools.writeImage(AWTTiffTools.java:155)
	at loci.formats.out.TiffWriter.saveBytes(TiffWriter.java:169)
	at loci.formats.out.TiffWriter.saveBytes(TiffWriter.java:191)
	at loci.formats.out.OMETiffWriter.saveBytes(OMETiffWriter.java:171)
	at loci.formats.FormatWriter.saveBytes(FormatWriter.java:89)
	at loci.plugins.exporter.Exporter.run(Exporter.java:364)
	at loci.plugins.LociExporter.run(LociExporter.java:73)
</pre>
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed 2009-08-24T10:11:30-05:00 by melissa
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        set to <em>bio-formats-4.1.0</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed 2009-10-12T10:15:31-05:00 by melissa
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
(In <a class="changeset" href="/trac/software/changeset/5579" title="Modify the input dataset's OME-XML before exporting.  Closes #405.
">[5579]</a>) Modify the input dataset's OME-XML before exporting.  Closes <a class="closed ticket" href="/trac/software/ticket/405" title="defect: OME-TIFF export erroneously reuses OME metadata from input dataset (closed: fixed)">#405</a>.
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/trac/software/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/trac/software/ticket/405?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/trac/software/ticket/405?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/trac/software/ticket/405?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/trac/software/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/trac/software/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the LOCI software web site at<br /><a href="http://loci.wisc.edu/software/">http://loci.wisc.edu/software/</a></p>
    </div>
  </body>
</html>
